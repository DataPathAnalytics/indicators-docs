#####################################################################################
RISK-1-2. Використання переговорної процедури закупівлі за відсутності законодавчих підстав (додаткова закупівля товару).
#####################################################################################

***************
Суть індикатора
***************

Даний індикатор виявляє ситуації, коли замовник безпідставно використовую переговорну процедуру.

************************************
Законодавче обґрунтування індикатора
************************************

Індикатор вводиться для ідентифікації можливого порушення статті 40 Закону України "Про публічні закупівлі".

********************************
Підстава для розробки індикатора
********************************

Цей індикатор було розроблено, оскільки система перевіряє підстави вибору замовником типу закупівлі.

*********************************
Методологія розрахунку індикатора
*********************************

Етап існування процедури
========================
Індикатор розраховується, коли процедура знаходиться на етапі *тендерингу*.

Рівень розрахунку
=================
Індикатор розраховується на рівні *тендера*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

Аналітична таблиця:

- :ref:`tbl_contracts3Years`

- `API курсу валют Національного Банку України <https://bank.gov.ua/control/uk/publish/article?art_id=38441973#exchange>`_


Типи процедур
=============

Індикатор розраховується для наступних типів процедур:

- ``negotiation`` - *перговорна прискорена*

- ``negotiation.quick`` - *переговорна процедура прискорена*

Типи замовників
===============

Індикатор розраховується для замовників типу (``general``)та (``special``).


Категорії товарів
=================

Індикатор розраховується для процедур закупівлі *товарів* відподівно до значення поля ``data.mainProcurementCategory = 'goods'``.


Стадії процедур
===============

Подія, що вмикає розрахунок індикатора
--------------------------------------

Подія, що вмикає розрахунок індикатора - перехід процедури у сатус ``active``.

Подія, що вимикає розрахунок індикатора
---------------------------------------

Розрахунок індикатора вимикається, якщо по всім лотам пропозиції розглянуто та обрано переможця (перехід процедури у сатус ``complete``).

Статуси процедур
----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується на наступні статуси процедур:
  
  - ``active``

Частота розрахунку
==================

Індикатор розраховується при будь-якій зміні json-документа, що відповідає процедурі, якщо присутні всі умови для його розрахунку.

Окрім цього індикатор перераховується раз на добу незалежно від змін у json-документі, що відповідає процедурі, якщо присутні всі умови для його розрахунку.


Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``data.tenderPeriod.startDate``
- ``data.value.amount``
- ``data.value.currency``
- ``data.lots.id``
- ``data.lots.value.amount``
- ``data.lots.value.currency``
- ``data.procuringEntity.identifier.scheme``
- ``data.procuringEntity.identifier.id``
- ``data.awards.relatedLot``
- ``data.awards.status``
- ``data.awards.suppliers.identifier.scheme``
- ``data.awards.suppliers.identifier.id``
- ``data.items.relatedLot``
- ``data.items.classification.id``

Для розрахунку індикатора використовуються наступні поля з API курсу валют Національного Банку України:

- ``cc``
- ``rate``
- ``exchangedate``

Формула розрахунку
==================

1. Якщо в процедурі ``data.cause != 'additionalPurchase'``, індикатор приймає значення ``-2`` розрахунок завершується.

2. Перевіряється валюта, в якій вказана очікувана вартість процедури відповідно до поля ``data.value.currency`` (для процедури без лотів), або ``data.lots.value.currency`` для кожного лота (якщо процедура багатолотова)

  2.а) Якщо очікувана вартість вказана в гривні, тобто ``data.value.currency = 'UAH'`` (``data.lots.value.currency = 'UAH'``), то вона залишається без змін

  2.б) Якщо очікувана вартість вказана не в гривні, то вона переводиться у гривню відповідно до курсу даної валюти до гривні за допомогою API курсу валют на дату ``data.tenderPeriod.startDate``. Якщо дане поле відсутнє у процедурі, то для розрахунку слід використати ``data.tender.date``.
  
  2.в) Якщо очікувана вартість не в гривні та API курсу валют Національного Банку України на момент розрахунку не відповідає, індикатор приймає значення ``-1``, розрахунок завершується.
  
3. Якщо в процедурі немає жодного об'єкту ``data.awards``, що має статус ``data.awards.status='active'``, індикатор приймає значення ``-2``, розрахунок завершується.

4. Вибираємо ідентифікатор замовника: конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``.

5. Якщо процедура без лотів:

  5.а) З об'єкту ``data.awards``, що має статус ``data.awards.status='active'`` вибираємо ідентифікатор переможця: конкатенація ``data.awards.suppliers.identifier.scheme`` та ``data.awards.suppliers.identifier.id``
  
  5.б) Вибираємо коди предметів закупівлі: усі ``data.items.classification.id``
  
  5.в) Вибираємо вартість процедури ``data.value.amount`` (розраховану у п. 1).
  
  5.г) За ідентифікатором замовника (п. 3), ідентифікатором перможця (п. 4.а.) та кодами закупівель (4.б.) шукаємо рядки у аналітичній таблиці. Якщо відповідного рядка не знаходимо, індикатор приймає значення ``1``, розрахунок завершується.
  
  5.д) Якщо рядок(рядки) знайдені, то перевіряємо, чи не перевищує сума процедури (розрахована у п. 1) 50% від суми в рядку таблиці. Якщо перевищує, індикатор приймає значення ``1``, розрахунок завершується. 
  
6. Якщо процедура багатолотова, для кожного ``data.awards``, що має статус ``data.awards.status='active'``:

  6.а) Вибираємо ідетифікатор переможця : конкатенація ``data.awards.suppliers.identifier.scheme`` та ``data.awards.suppliers.identifier.id``
  
  6.б) Вибираємо коди предметів закупівлі: ``data.items.classification.id`` з об'єктів ``data.items``, що мають ``data.items.relatedLot=data.awards.relatedLot``
  
  6.г) За ідентифікатором замовника (п. 3), ідентифікатором перможця (п. 5.а.) та кодами закупівель (5.б.) шукаємо рядки у аналітичній таблиці. Якщо відповідного рядка не знаходимо, індикатор приймає значення ``1``, розрахунок завершується.
  
  6.д) Якщо рядок(рядки) знайдені, то перевіряємо, чи не перевищує сума лота (розрахована у п. 1) 50% від суми в рядку таблиці. Якщо перевищує, індикатор приймає значення ``1``, розрахунок завершується.

7. Якщо ми дійшли до цього пункта, індикатор дорівнює ``0``.

Фактори, що впливають на неточність розрахунку
==============================================

1. Індикатор може бути порахований неточно у випадках, коли замовники в окремих сферах господарювання і організації, що не є замовниками, помилково визначають себе в системі як загальні замовники.

2. Індикатор може бути порахований неточно у випадках, коли замовником неправильно визначено тип процедури.

