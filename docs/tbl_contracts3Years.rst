.. _tbl_contracts3Years:

===================
tbl_contracts3Years
===================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає що та на які суми закупали замовники у постачальників за оснанні 3 роки.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовник
- Ідентифікатор постачальника
- Код предмету закупки
- Сума контракту

Приклад того, як може виглядати аналітична таблиця:

========== ============== ========= ======
Замовник   Постачальник   Код CPV   Сума
---------- -------------- --------- ------
Замовник 1 Постачальник 1 Код CPV 1 Сума 1
Замовник 1 Постачальник 2 Код CPV 2 Сума 2
Замовник 1 Постачальник 3 Код CPV 3 Сума 3
Замовник 2 Постачальник 1 Код CPV 4 Сума 4
Замовник 2 Постачальник 2 Код CPV 5 Сума 5
...            ...        ...       ...
========== ============== ========= ======

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

- API модуля контрактинга електронної системи закупівель


Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``data.procurementMethodType``
- ``data.id``

Для розрахунку індикатора використовуються наступні поля з API модуля контрактинга:

- ``data.procuringEntity.identifier.scheme``
- ``data.procuringEntity.identifier.id``
- ``data.suppliers.identifier.scheme`` 
- ``data.suppliers.identifier.id``
- ``data.items.classification.id``
- ``data.value.amount``

Формула розрахунку
==================

1. Вибираються тільки контракти, що заключені в межах процедур, що мають типи ``data.procurementMethodType='aboveThresholdUA'`` або ``data.procurementMethodType='aboveThresholdEU'``.

2. Залишаємо тільки контракти, що були підписані не пізніше, ніж 3 роки тому від поточної дати.

3. Вибираємо ідентифікатор замовника: конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``.

4. Вибираємо ідентифікатор переможця: конкатенація ``data.suppliers.identifier.scheme`` та ``data.suppliers.identifier.id``
  
5. Вибираємо коди предметів закупівлі: усі ``data.items.classification.id``
  
6. Вибираємо суму контракту ``data.value.amount``.

7. Проводимо групування по замовнику, переможцю та коду предмету закупівлі обираючи найранішу дату підписання та суму контракта, що відповідає найранішій даті.
