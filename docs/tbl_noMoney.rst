.. _tbl_noMoney:

===========
tbl_noMoney
===========

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає, список кодів CPV для кожного замовника з процедур або лотів, що замовник відминив за причини скорочення фінансування у поточному році.


*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовника
- Список кодів CPV
- Дата відміни

Приклад того, як може виглядати аналітична таблиця:

========== ==== ==============
Замовник   CPV  Дата відміни
---------- ---- --------------
Замовник 1 CPV1 Дата відміни 1
Замовник 1 CPV2 Дата відміни 2
Замовник 1 CPV3 Дата відміни 3
Замовник 2 CPV4 Дата відміни 4
Замовник 2 CPV1 Дата відміни 5
...        ...  ...
========== ==== ==============

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель


Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.tenderID``

- ``data.procurementMethodType``

- ``data.status``

- ``data.date``

- ``data.cancellations.cancellationOf``

- ``data.cancellations.status``

- ``data.cancellations.relatedLot``

- ``data.cancellations.reason``

- ``data.items.relatedLot``

- ``data.items.classification.id``

- ``data.procuringEntity.identifier.scheme``

- ``data.procuringEntity.identifier.id``

Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. Визначаємо рік створення процедури. Вибираємо 4 символи, починаючи з 4-го з поля ``data.tenderID``.

3. До уваги беремо процедури, що оголошені лише в поточному році.

4. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``aboveThresholdUA``, ``aboveThresholdEU``. 

5. До уваги беруться тільки процедури, що мають об'єкти ``data.cancellations`` зі статусом ``data.cancellations.status='active'`` та поле ``data.cancellations.reason`` містить у собі наступний регулярний вираз ".*скороч.*видатк.*|.*видатк.*скороч.*".

6. Якщо у знайденому блоку ``data.cancellations.cancellationOf='tender'``, то вибираємо усі ``data.items.classification.id`` з процедури.

7. Якщо знайденому блоку ``data.cancellations.cancellationOf='lot'``, то вибираємо усі ``data.items.classification.id``, що відносяться до лота ``data.items.relatedLot=data.cancellations.relatedLot``

8. Знаходимо ідентифікатор замовника - конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``.

9. Знаходимо дату відміни процедури ``data.date``. 

10. Групуємо дані по ідентифікатору замовника та коду CPV та вибираємо найпізнішу дату відміни процедури. Результат заносимо в таблицю.
  
