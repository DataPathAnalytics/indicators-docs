##############################################################################################
RISK-1-6. Перевищення строку оприлюднення оголошення з відомостями про укладену рамкову угоду.
##############################################################################################

***************
Суть індикатора
***************

Індикатор свідчить про: 
Невчасну публікацію замовником відомостей про укладену рамкову угоду.

************************************
Законодавче обґрунтування індикатора
************************************

Стаття 10. Оприлюднення інформації про закупівлю:

П. 1, пп. 5. оголошення з відомостями про укладену рамкову угоду (у разі здійснення закупівлі за рамковими угодами) - не пізніше ніж через сім днів з дня укладення рамкової угоди.


********************************
Підстава для розробки індикатора
********************************

Свідчить про ймовірне порушення вимог підпункту 5 частини 1 статті 10 Закону.
Автоматичний контроль терміном оприлюднення змін до договору відсутній в системі. 

*********************************
Методологія та алгоритм розрахунку індикатора
*********************************

Етап існування процедури
========================
Індикатор розраховується, коли процедура знаходиться на етапі *тендерінгу*.


Рівень розрахунку
=================
Індикатор розраховується для переговорних процедур на рівні *лота*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора використовуються наступні джерела даних:

- API модуля контрактинга електронної системи закупівель

Типи процедур
=============

Індикатор розраховується для договорів наступних типів процедур:

- ``closeFrameworkAgreementUA`` - *укладання рамкової угоди*


Типи замовників
===============

Індикатор розраховується для замовників які в системі визначені як:
 + ``authority`` - Орган державної влади, місцевого самоврядування або правоохоронний орган
 + ``central`` - Юридична особа, що здійснює закупівлі в інтересах замовників (ЦЗО)
 + ``general`` - Юридична особа, яка забезпечує потреби держави або територіальної громади
 + ``social`` -	Орган соціального страхування
 + ``special`` - Юридична особа, яка здійснює діяльність в одній або декількох окремих сферах господарювання

Стадії процедури
================

Подія, що вмикає розрахунок індикатора
--------------------------------------

Подія, що вмикає розрахунок індикатора - перехід проседури в статус ``active.awarded``.


Подія, що вимикає розрахунок індикатора
---------------------------------------

Розрахунок індикатора вимикається, коли процедура переходить в статус ``complete``.

Статуси процедур
----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується, якщо статус договору дорівнює ``active.awarded``.


Частота розрахунку
==================

Якщо виконані умови для розрахунку індикатора, він розраховується при кожній зміні json-документа а також один раз на добу незалежно від наявності змін у json-документі.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля контрактинга:

- ``data.agreements.dateSigned``
- ``data.agreements.documents.format``
- ``data.agreements.documents.documentType``
- ``data.agreements.documents.datePublished``

Робота з датами
===============
Усі дати конвертуються до місцевої часової зони, враховуючи зимовий/літній час. Після конвертації залишаємо лише дату, відкидаючи час.

Кількість днів від Дати1 до Дати2 розраховуємо так: розрахунок починаємо від наступного дня від Дати1 и закінчуємо Датою2, тобто Дату1 в розрахунок не включаємо, а Дату2 в розрахунок включаємо.



Формула розрахунку
==================
1. Якщо в процедурі немає угоди - відсутній блок ``data.agreements``, індикатор приймає значення ``-2``, розрахунок завершується.

2. Якщо в процедурі є угоди, для кожної угоди ``data.agreements`` робимо наступне.

2.1. Вибираємо дату підписання угоди ``data.agreements.dateSigned``.

2.2. Знаходимо усі документи, що належать до підписання угоди: ``data.agreements.documents``, що мають ``data.agreements.documents.documentType='contractSigned'`` та ``data.agreements.documents.format`` не дорівнює ``application/pkcs7-signature``.

2.3. Вибираємо дати публікації документів ``data.agreements.documents.datePublished`` з п. 2.2.

2.4. Визначаємо найранішу дату публікації зі знайдених на попередньому кроці.

2.4. Порівнюємо дату підписання угоди (п. 2.1.) та найранішу дату публікації документу (п. 2.4.). Якщо між датами пройшло більше ніж 7 днів, індикатор приймає значення ``1``, розрахунок завершується.

2.5. Якщо для угоди не знайдено жодного документа, то порівнюємо дату підписання зміни (п. 2.1.) з поточною датою. Якщо між датами пройшло більше ніж 7 днів, індикатор приймає значення ``1``, розрахунок завершується.

3. Якщо ми дійшли до цього пункту, індикатор приймає значення ``0``.


Фактори, що впливають на неточність розрахунку
==============================================

Індикатор може бути спрацьований некоректно у випадках, коли представник замовника некоректно вказує дату угоди.
