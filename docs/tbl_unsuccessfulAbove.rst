.. _tbl_unsuccessfulAbove:

=====================
tbl_unsuccessfulAbove
=====================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця показує кількість неуспішних лотів відкритих процедур певного замовника по певному предмету закупівлі від поточної дати до дати проведення останньої переговорної процедури по цьому предмету закупівлі у цього замовника (або від поточної дати до дати, що передує поточній на 1 рік, якщо такої переговорної процедури немає).

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Замовник
- Предмет закупівлі
- Кількість неуспішних лотів відкритих процедур цього замовника по цьому предмету закупівлі від поточної дати до дати останньої переговорної процедури цього замовника по цьому предмету закупівлі (або до дати, що передує поточній на 1 рік, якщо такої переговорної процедури немає)

Приклад того, як може виглядати аналітична таблиця:

========== ================= =============================================
Замовник   Предмет закупівлі Кількість неуспішних лотів відкритих процедур
---------- ----------------- ---------------------------------------------
Замовник 1 Предмет 1         1
Замовник 1 Предмет 2         3
Замовник 1 Предмет 3         2
Замовник 2 Предмет 1         4
Замовник 2 Предмет 2         1
...        ...               ...
========== ================= =======================================

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

- Транзакційна змінна :ref:`tv_tenderCPVList`

- Транзакційна змінна :ref:`tv_procuringEntity`

Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.id``
- ``data.procurementMethodType``
- ``data.status``
- ``data.date``
- ``data.lots.id``
- ``data.lots.status``
- ``data.bids.status``
- ``data.bids.lotValues.relatedLot``

Для розрахунку використовуються наступні транзакційні змінні:

- :ref:`tv_tenderCPVList`

- :ref:`tv_procuringEntity`

Формула розрахунку
==================

Для кожного замовника :ref:`tv_procuringEntity` та предмету закупівлі :ref:`tv_tenderCPVList` виконуються наступні дії:

1. Визначається дата, з якої починається підрахунок неуспішних відкритих процедур. Порядок визначення цієї дати наступний:

    а) Для даного замовника та даного предмету закупівлі необхідно знайти останню (найближчу до 
    поточної дати) завершену переговорну процедуру цього ж замовника по цьому ж предмету 
    закупівлі. Ознака переговорної процедури: ``data.procurementMethodType = 'negotiation'`` або 
    ``data.procurementMethodType = 'negotiation.quick'`` тa має ``data.cause='twiceUnsuccessful'``. Ознака завершеної процедури: 
    ``data.status = 'complete'``. Близькість процедури до поточної дати визначається з поля 
    ``data.date``. Але розглядаємо процедури, у яких ``data.date`` не пізніше, ніж 1 рік від поточної дати.

    б) Припустимо, що така процедура знайдена. Якщо дата цієї процедури ``data.date`` 
    відрізняється від поточної дати менше ніж на рік, то ця дата і є датою, з якої починається 
    підрахунок неуспішних відкритих процедур. В інакшому випадку датою, з якої починається 
    підрахунок неуспішних відкритих процедур, є дата, що передує поточній на 1 рік.

    в) Якщо по даному замовнику та предмету закупівлі переговорних процедур не знайдено, то 
    датою, з якої починається підрахунок неуспішних відкритих процедур, є дата, що передує 
    поточній на 1 рік.

2. Для даного замовника та даного предмету закупівлі рахується кількість неуспішних лотів відкритих процедур у проміжку часу від дати, визначеної в пункті 1, до поточної дати. Ознака відкритої процедури: ``data.procurementMethodType = 'aboveThresholdUA'`` або ``data.procurementMethodType = 'aboveThresholdEU'``. Ознака неуспішного лота процедури: ``data.lots.status = 'unsuccessful'`` та на лот посилається не більше одної тендерної пропозиції ``data.bids.lotValues.relatedLot=data.lots.id``, що мають ``data.bids.status='active'``. Для однолотової процедури ознакою неуспішності вважається кількість не більше одної тендерної пропозиції, що має ``data.bids.status='active'``. Належність процедури до заданого проміжку визначається з дати ``data.date`` (це поле має бути між поточною датою та датою, визначеною в пункті 1)

3. Якщо по деякому замовнику та предмету закупівлі від поточної дати до дати останної переговорної процедури (або дати, що передує поточній на 1 рік) не знайдено жодної неуспішної відкритої процедури, то запис по цьому замовнику не вноситься в таблицю взагалі (не потрібно вносити запис, в якому кількість буде рівна 0)
